name: Aggiorna estrazioni Lotto

on:
  schedule:
    - cron: '30 20 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - run: pip install requests beautifulsoup4

      - name: Aggiorna storico.json
        run: |
          python <<EOF
          import json
          import requests
          from bs4 import BeautifulSoup

          url = "https://www.superenalotto.it/risultati/lotto"

          r = requests.get(url)
          soup = BeautifulSoup(r.text, "html.parser")

          ruote = ["Bari","Cagliari","Firenze","Genova","Milano",
                   "Napoli","Palermo","Roma","Torino","Venezia","Nazionale"]

          storico = {}

          for ruota in ruote:
              numeri = []
              sezione = soup.find("h3", string=ruota)
              if sezione:
                  ul = sezione.find_next("ul")
                  if ul:
                      numeri = [int(li.text) for li in ul.find_all("li")]
              storico[ruota] = numeri

          with open("storico.json", "w") as f:
              json.dump(storico, f, indent=2)

          print("Aggiornamento completato")
          EOF

      - name: Commit changes
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add storico.json
          git commit -m "Aggiornamento automatico estrazioni" || echo "Nessuna modifica"
          git push




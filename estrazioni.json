<!DOCTYPE html>
<html>
<body>

<h2>Generatore JSON Lotto COMPLETO</h2>

<p>Storico principale:</p>
<input type="file" id="file1"><br><br>

<p>Nazionale 2025:</p>
<input type="file" id="file2"><br><br>

<p>Nazionale 2026:</p>
<input type="file" id="file3"><br><br>

<button onclick="genera()">Genera JSON Finale</button>
<button onclick="copia()">Copia JSON</button>

<br><br>
<textarea id="out" style="width:100%;height:400px;"></textarea>

<script>

const nomiRuote = {
 "BA":"Bari","CA":"Cagliari","FI":"Firenze","GE":"Genova",
 "MI":"Milano","NA":"Napoli","PA":"Palermo",
 "RM":"Roma","TO":"Torino","VE":"Venezia",
 "NZ":"Nazionale"
};

function leggi(file){
 return new Promise(res=>{
  let r=new FileReader();
  r.onload=e=>res(e.target.result);
  r.readAsText(file);
 });
}

async function genera(){

 let f1=document.getElementById("file1").files[0];
 let f2=document.getElementById("file2").files[0];
 let f3=document.getElementById("file3").files[0];

 if(!f1||!f2||!f3){
   alert("Seleziona tutti i file");
   return;
 }

 let txt1=await leggi(f1);
 let txt2=await leggi(f2);
 let txt3=await leggi(f3);

 let ruote={};

 function aggiungi(sigla,numeri){
   let nome=nomiRuote[sigla];
   if(!nome) return;
   if(!ruote[nome]) ruote[nome]=[];
   ruote[nome].push(numeri);
 }

 // storico principale
 txt1.split("\n").forEach(r=>{
   let c=r.trim().split(/\s+/);
   if(c.length<7) return;
   aggiungi(c[1],[+c[2],+c[3],+c[4],+c[5],+c[6]]);
 });

 // nazionale
 function estraiNZ(t){
   t.split("\n").forEach(r=>{
     let c=r.trim().split(/\s+/);
     if(c.length<56 || c[0]=="DATE") return;
     let n=c.slice(-5).map(Number);
     aggiungi("NZ",n);
   });
 }

 estraiNZ(txt2);
 estraiNZ(txt3);

 document.getElementById("out").value =
   JSON.stringify(ruote,null,2);
}

// ðŸ”¥ PULSANTE COPIA
function copia(){
  let out=document.getElementById("out");
  out.select();
  document.execCommand("copy");
  alert("JSON copiato!");
}

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Lotto Live Statistiche</title>

<style>
body {
  background: #0f172a;
  color: white;
  font-family: Arial, sans-serif;
  margin: 20px;
}

h1 {
  color: orange;
  text-align: center;
}

.card {
  background: #1e293b;
  padding: 20px;
  margin-bottom: 20px;
  border-radius: 12px;
  border: 2px solid #334155;
}

.ruota-forte {
  border: 2px solid gold;
}

button {
  background: orange;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  margin-top: 5px;
}

button:hover {
  background: gold;
}

.premium-box {
  background: #111;
  padding: 20px;
  border-radius: 12px;
  border: 2px solid gold;
}
</style>
</head>

<body>

<h1>ğŸ”¥ Lotto Live Statistiche ğŸ”¥</h1>

<div id="contenuto"></div>

<hr style="margin:40px 0; border:2px solid orange;">

<div class="premium-box">
  <h2 style="color:gold;">ğŸ¯ Giocate Attive Premium</h2>
  <div id="listaGiocate"></div>
</div>

<script>

const API_URL = "https://lotto-statistiche.onrender.com";

function salvaAmbo(num1, num2, ruota) {

  fetch(API_URL + "/salva-ambo", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ num1, num2, ruota })
  })
  .then(res => res.json())
  .then(data => {
    alert("Ambo salvato! Durata: " + data.durata_calcolata);
    caricaGiocatePremium();
  });
}

function caricaDati() {
  fetch(API_URL + "/api")
    .then(res => res.json())
    .then(data => {

      const container = document.getElementById("contenuto");
      container.innerHTML = "";

      const ruotaForte = data.ruota_forte;

      for (let ruota in data) {

        if (ruota === "ruota_forte") continue;

        const stats = data[ruota];
        let classe = "card";
        if (ruota === ruotaForte) classe += " ruota-forte";

        let ambiHTML = "";

        stats.ambi_forti.forEach(ambo => {
          ambiHTML += `
            <div>
              ğŸ’ ${ambo[0]}-${ambo[1]}
              <button onclick="salvaAmbo(${ambo[0]}, ${ambo[1]}, '${ruota}')">
                ğŸ’¾ Salva Premium
              </button>
            </div>
          `;
        });

        container.innerHTML += `
          <div class="${classe}">
            <h2>${ruota} ${ruota === ruotaForte ? "â­ RUOTA FORTE" : ""}</h2>
            <p>Ultima estrazione: ${stats.ultima_estrazione.join(", ")}</p>
            <p>ğŸ”¥ Caldi: ${stats.caldi.join(", ")}</p>
            <p>â„ï¸ Freddi: ${stats.freddi.join(", ")}</p>
            <p>â³ Ritardatario: ${stats.ritardatario}</p>
            <p>ğŸ¯ DA GIOCARE: ${stats.da_giocare.join(", ")}</p>
            <p>âš¡ Indice Pressione: ${stats.indice_pressione}</p>
            <div>${ambiHTML}</div>
          </div>
        `;
      }
    });
}

function caricaGiocatePremium() {
  fetch(API_URL + "/giocate-attive")
    .then(res => res.json())
    .then(data => {

      const container = document.getElementById("listaGiocate");
      container.innerHTML = "";

      if (!data || data.length === 0) {
        container.innerHTML = "<p>Nessuna giocata attiva</p>";
        return;
      }

      data.forEach(g => {

        let colore = "lime";
        let statoTesto = "ATTIVO";

        if (g.stato === "scaduto") {
          colore = "red";
          statoTesto = "SCADUTO";
        }

        if (g.stato === "uscito") {
          colore = "gold";
          statoTesto = "USCITO ğŸ’°";
        }

        container.innerHTML += `
          <div style="
            margin-bottom:15px;
            padding:15px;
            border:2px solid ${colore};
            border-radius:8px;
            background:#1a1a1a;
          ">
            <strong>${g.tipo.toUpperCase()} ${g.num1}-${g.num2}</strong><br>
            Ruota: ${g.ruota}<br>
            Durata: ${g.durata_attuale}<br>
            Passate: ${g.estrazioni_passate}<br>
            <span style="color:${colore}; font-weight:bold;">
              Stato: ${statoTesto}
            </span>
          </div>
        `;
      });
    });
}

caricaDati();
caricaGiocatePremium();

</script>

</body>
</html>

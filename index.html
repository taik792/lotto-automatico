<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Lotto Live Evolution PRO REAL</title>

<style>
body{
    background:#0f1720;
    color:white;
    font-family:Arial;
}
h1{text-align:center;}
button{
    padding:6px 12px;
    margin-top:6px;
    background:#ff9800;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.container{width:90%;margin:auto;}
.box{
    border:2px solid orange;
    border-radius:10px;
    padding:15px;
    margin:15px 0;
    background:#1a2530;
}
.migliore{
    border:3px solid gold;
    background:#222b36;
}
#giocateAttive{
    border:2px solid gold;
    padding:10px;
    border-radius:10px;
    margin-bottom:20px;
}
.stat{margin:4px 0;}
</style>
</head>

<body>

<h1>üî• Lotto Live Evolution PRO REAL</h1>

<div class="container">

<div id="giocateAttive"></div>
<div id="ruoteContainer"></div>

<h3>üìä Statistiche Sistema</h3>
<div id="percentualeBox">Percentuale Successo: 0%</div>

</div>

<script>

let estrazioni = {};
let migliorRuotaGlobale = null;

// ORDINE UFFICIALE LOTTO
let ordineRuote = [
"Bari","Cagliari","Firenze","Genova","Milano",
"Napoli","Palermo","Roma","Torino","Venezia"
];

fetch("estrazioni.json")
.then(r=>r.json())
.then(data=>{
    estrazioni = data;
    generaDashboard();
})
.catch(()=>alert("Errore caricamento JSON"));


// ===== ANALISI RUOTA =====
function analizzaRuota(nome){

    let dati = estrazioni[nome];
    let ultime = dati.slice(-50);

    let conteggio={};
    for(let i=1;i<=90;i++) conteggio[i]=0;

    ultime.forEach(estr=>{
        estr.forEach(n=>conteggio[n]++);
    });

    let ordinati = Object.entries(conteggio)
        .sort((a,b)=>b[1]-a[1]);

    let caldi = ordinati.slice(0,3).map(x=>parseInt(x[0]));
    let freddi = ordinati.slice(-3).map(x=>parseInt(x[0]));

    return {
        caldi,
        freddi,
        topFreq: ordinati[0][1],
        ultima: dati[dati.length-1]
    };
}


// ===== GENERA DASHBOARD =====
function generaDashboard(){

    let container = document.getElementById("ruoteContainer");
    container.innerHTML="";
    let migliorFreq=-1;

    // calcolo ruota migliore
    ordineRuote.forEach(ruota=>{
        if(!estrazioni[ruota]) return;
        let a = analizzaRuota(ruota);
        if(a.topFreq>migliorFreq){
            migliorFreq=a.topFreq;
            migliorRuotaGlobale=ruota;
        }
    });

    ordineRuote.forEach(ruota=>{

        if(!estrazioni[ruota]) return;

        let a = analizzaRuota(ruota);

        let box=document.createElement("div");
        box.className="box";
        if(ruota===migliorRuotaGlobale) box.classList.add("migliore");

        box.innerHTML=`
            <h3>${ruota} ${ruota===migliorRuotaGlobale?"‚≠ê":""}</h3>
            <div class="stat">Ultima: ${a.ultima.join(" - ")}</div>
            <div class="stat">üî• Caldi: ${a.caldi.join(", ")}</div>
            <div class="stat">‚ùÑ Freddi: ${a.freddi.join(", ")}</div>
            <div class="stat">üìä Frequenza Top: ${a.topFreq}</div>
            <div class="stat">üéØ Ambo Forte: ${a.caldi[0]} - ${a.freddi[0]}</div>
            <button onclick="salvaPrevisione('${ruota}',${a.caldi[0]},${a.freddi[0]})">
                Salva ambo forte
            </button>
        `;

        container.appendChild(box);
    });

    aggiornaGiocateAttive();
}


// ===== SALVA PREVISIONE =====
function salvaPrevisione(ruota,n1,n2){

    let previsione={
        ruota,
        numeri:[n1,n2],
        durata:8,
        restanti:8,
        vinta:false,
        indice: 0   // parte dalla prima estrazione disponibile
    };

    localStorage.setItem("previsioneAttiva",JSON.stringify(previsione));
    aggiornaGiocateAttive();
}


// ===== MOSTRA GIOCATA ATTIVA =====
function aggiornaGiocateAttive(){

    let box=document.getElementById("giocateAttive");
    let p=JSON.parse(localStorage.getItem("previsioneAttiva"));

    if(!p){
        box.innerHTML="<strong>üéØ Nessuna giocata attiva</strong>";
        return;
    }

    box.innerHTML=`
        <strong>üéØ Giocata Attiva Premium</strong><br>
        ${p.ruota} ‚Üí ${p.numeri.join("-")} 
        (ancora ${p.restanti} estr.)
        <button onclick="simulaEstrazione()">Simula Estrazione</button>
    `;
}


// ===== SIMULA ESTRAZIONE REALISTICA =====
function simulaEstrazione(){

    let p=JSON.parse(localStorage.getItem("previsioneAttiva"));
    if(!p) return;

    let lista = estrazioni[p.ruota];

    if(p.indice >= lista.length){
        alert("Fine estrazioni disponibili nel JSON");
        return;
    }

    let estrCorrente = lista[p.indice];

    let vinta = p.numeri.every(n => estrCorrente.includes(n));

    p.restanti--;
    p.indice++;

    if(vinta){
        alert("üéâ AMBO USCITO ALLA ESTRAZIONE " + p.indice);
        salvaStorico(p,true);
        localStorage.removeItem("previsioneAttiva");
    }
    else if(p.restanti<=0){
        salvaStorico(p,false);
        evolvi(p);
    }
    else{
        localStorage.setItem("previsioneAttiva",JSON.stringify(p));
    }

    aggiornaGiocateAttive();
    aggiornaPercentuale();
}


// ===== EVOLUZIONE =====
function evolvi(p){

    if(p.durata===8)p.durata=12;
    else if(p.durata===12)p.durata=16;
    else{
        localStorage.removeItem("previsioneAttiva");
        return;
    }

    p.restanti=p.durata;
    localStorage.setItem("previsioneAttiva",JSON.stringify(p));
}


// ===== STORICO =====
function salvaStorico(p,vinta){

    let storico=JSON.parse(localStorage.getItem("storico"))||[];

    storico.push({
        ruota:p.ruota,
        numeri:p.numeri,
        esito:vinta?"VINTA":"PERSA",
        data:new Date().toLocaleString()
    });

    localStorage.setItem("storico",JSON.stringify(storico));
}


// ===== PERCENTUALE =====
function aggiornaPercentuale(){

    let storico=JSON.parse(localStorage.getItem("storico"))||[];
    let vinte=storico.filter(s=>s.esito==="VINTA").length;
    let perc=storico.length?((vinte/storico.length)*100).toFixed(1):0;

    document.getElementById("percentualeBox").innerText=
        "Percentuale Successo: "+perc+"%";
}

aggiornaPercentuale();

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Lotto Live â€“ Premium AI</title>

<style>
body{
    background:#111;
    color:white;
    font-family:Arial;
    text-align:center;
}

button{
    padding:10px 20px;
    margin:10px;
    font-size:16px;
    cursor:pointer;
}

#box{
    margin-top:30px;
    padding:20px;
    background:#222;
    border-radius:10px;
    width:70%;
    margin:auto;
}

.stat{
    margin:5px;
}
</style>
</head>
<body>

<h1>ðŸŽ¯ Lotto Live â€“ Premium AI</h1>

<button onclick="generaPrevisione()">Genera Previsione AI</button>
<button onclick="simulaEstrazione()">Simula Estrazione</button>

<div id="box">
    <h2>ðŸ“Š Statistiche Sistema</h2>
    <div id="percentualeBox">Percentuale Successo: 0%</div>
    <div id="analisiBox"></div>
    <div id="storicoBox"></div>
</div>

<script>

let estrazioniGlobali = [];

// ===== CARICA JSON =====
fetch("estrazioni.json")
.then(res => res.json())
.then(data => {
    estrazioniGlobali = data;
})
.catch(err => {
    alert("Errore caricamento estrazioni.json");
});


// ===== ANALISI =====
function analizzaRuota(ruota){

    let ultime = estrazioniGlobali.slice(-50);
    let conteggio = {};

    for(let i=1;i<=90;i++) conteggio[i]=0;

    ultime.forEach(e=>{
        if(e.ruote[ruota]){
            e.ruote[ruota].forEach(n=>{
                conteggio[n]++;
            });
        }
    });

    let ordinati = Object.entries(conteggio)
        .sort((a,b)=>b[1]-a[1]);

    let caldi = ordinati.slice(0,5).map(x=>parseInt(x[0]));
    let freddi = ordinati.slice(-5).map(x=>parseInt(x[0]));

    return {caldi, freddi};
}


// ===== GENERA PREVISIONE AI =====
function generaPrevisione(){

    if(estrazioniGlobali.length===0){
        alert("JSON non ancora caricato");
        return;
    }

    let ruote = Object.keys(estrazioniGlobali[0].ruote);
    let ruotaScelta = ruote[Math.floor(Math.random()*ruote.length)];

    let analisi = analizzaRuota(ruotaScelta);

    let numeri = [
        analisi.caldi[0],
        analisi.freddi[0]
    ];

    let previsione = {
        numeri,
        ruota: ruotaScelta,
        durata: 8,
        estrazioniRestanti: 8,
        vinta:false
    };

    localStorage.setItem("previsioneAttiva", JSON.stringify(previsione));

    document.getElementById("analisiBox").innerHTML = `
        <div class="stat">Ruota: ${ruotaScelta}</div>
        <div class="stat">Caldi: ${analisi.caldi.join(", ")}</div>
        <div class="stat">Freddi: ${analisi.freddi.join(", ")}</div>
        <div class="stat"><strong>Previsione: ${numeri.join(" - ")}</strong></div>
    `;
}


// ===== SIMULA ESTRAZIONE =====
function simulaEstrazione(){

    let previsione = JSON.parse(localStorage.getItem("previsioneAttiva"));
    if(!previsione) return alert("Genera prima previsione");

    previsione.estrazioniRestanti--;

    if(Math.random()<0.25){
        previsione.vinta=true;
        alert("ðŸŽ‰ AMBO USCITO!");
        salvaStorico(previsione);
        localStorage.removeItem("previsioneAttiva");
    }

    if(!previsione.vinta && previsione.estrazioniRestanti<=0){
        salvaStorico(previsione);
        evolviSistema(previsione);
    } else if(!previsione.vinta){
        localStorage.setItem("previsioneAttiva", JSON.stringify(previsione));
    }

    mostraStorico();
    aggiornaPercentuale();
}


// ===== EVOLUZIONE =====
function evolviSistema(p){

    if(p.durata===8) p.durata=12;
    else if(p.durata===12) p.durata=16;
    else return generaPrevisione();

    p.estrazioniRestanti=p.durata;
    p.vinta=false;

    localStorage.setItem("previsioneAttiva", JSON.stringify(p));
    alert("Sistema evoluto a "+p.durata);
}


// ===== STORICO =====
function salvaStorico(p){

    let storico = JSON.parse(localStorage.getItem("storicoLotto"))||[];

    storico.push({
        numeri:p.numeri,
        ruota:p.ruota,
        durata:p.durata,
        esito:p.vinta?"VINTA":"PERSA",
        data:new Date().toLocaleString()
    });

    localStorage.setItem("storicoLotto", JSON.stringify(storico));
}


function mostraStorico(){

    let storico = JSON.parse(localStorage.getItem("storicoLotto"))||[];
    let box=document.getElementById("storicoBox");

    box.innerHTML="<h3>Storico</h3>";

    storico.slice().reverse().forEach(s=>{
        box.innerHTML+=`
        <div>
        ${s.data} | ${s.ruota} | ${s.numeri.join(", ")} 
        <strong style="color:${s.esito==="VINTA"?"lime":"red"}">
        ${s.esito}
        </strong>
        </div>`;
    });
}


// ===== PERCENTUALE =====
function aggiornaPercentuale(){

    let storico=JSON.parse(localStorage.getItem("storicoLotto"))||[];
    let vinte=storico.filter(s=>s.esito==="VINTA").length;
    let perc=storico.length===0?0:
        ((vinte/storico.length)*100).toFixed(1);

    document.getElementById("percentualeBox").innerHTML=
        "Percentuale Successo: "+perc+"%";
}

document.addEventListener("DOMContentLoaded",()=>{
    mostraStorico();
    aggiornaPercentuale();
});

</script>

</body>
</html>

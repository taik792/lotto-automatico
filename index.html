<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Lotto Live Statistiche</title>
<style>
body { font-family: Arial; background:#0f172a; color:white; padding:20px }
h1 { text-align:center; color:#38bdf8 }
.box { background:#1e293b; padding:15px; margin:15px 0; border-radius:12px }
.badge { padding:4px 8px; margin:2px; border-radius:8px; display:inline-block }
.caldi { background:#dc2626 }
.freddi { background:#2563eb }
.prev { background:#16a34a }
</style>
</head>
<body>

<h1>ðŸ“Š Lotto Live Statistiche</h1>
<div id="contenuto">Caricamento dati realiâ€¦</div>

<script>

const PROXY_URL = "https://api.allorigins.win/raw?url=";
const TARGET_URL = "https://www.superenalotto.it/estrazioni/lotto";

function calcolaStatistiche(estrazioni){
    let freq = {};
    let ultimo = {};
    let ritardi = {};

    estrazioni.forEach((numeri, index)=>{
        numeri.forEach(n=>{
            freq[n] = (freq[n] || 0) + 1;
            if(!(n in ultimo)){
                ultimo[n] = index;
            }
        });
    });

    for(let n=1; n<=90; n++){
        ritardi[n] = (n in ultimo) ? ultimo[n] : estrazioni.length;
    }

    return {freq, ritardi};
}

function estraiNumeriDalTesto(testo, ruota){
    const regex = new RegExp(ruota + ".*?(\\d{1,2}).*?(\\d{1,2}).*?(\\d{1,2}).*?(\\d{1,2}).*?(\\d{1,2})","is");
    const match = testo.match(regex);
    if(match){
        return match.slice(1,6).map(n => parseInt(n));
    }
    return [];
}

fetch(PROXY_URL + TARGET_URL)
.then(r => r.text())
.then(html => {

    const RUOTE = [
        "Bari","Cagliari","Firenze","Genova","Milano",
        "Napoli","Palermo","Roma","Torino","Venezia","Nazionale"
    ];

    let htmlOutput = "";

    RUOTE.forEach(ruota => {

        const numeri = estraiNumeriDalTesto(html, ruota);

        if(numeri.length === 0) return;

        const estrazioni = [numeri];
        const stats = calcolaStatistiche(estrazioni);

        const caldi = Object.keys(stats.freq)
            .sort((a,b)=>stats.freq[b]-stats.freq[a])
            .slice(0,5);

        const freddi = Object.keys(stats.ritardi)
            .sort((a,b)=>stats.ritardi[b]-stats.ritardi[a])
            .slice(0,5);

        const previsione = [...new Set([
            ...caldi.slice(0,3),
            ...freddi.slice(0,2)
        ])];

        htmlOutput += `
        <div class="box">
            <h2>${ruota}</h2>
            <strong>Ultima estrazione:</strong><br>
            ${numeri.join(", ")}<br><br>

            ðŸ”¥ Caldi:
            ${caldi.map(n=>`<span class="badge caldi">${n}</span>`).join("")}<br><br>

            â„ Freddi:
            ${freddi.map(n=>`<span class="badge freddi">${n}</span>`).join("")}<br><br>

            ðŸŽ¯ Previsione:
            ${previsione.map(n=>`<span class="badge prev">${n}</span>`).join("")}
        </div>
        `;
    });

    if(htmlOutput === ""){
        document.getElementById("contenuto").innerText = "Impossibile leggere dati reali (blocco CORS del sito).";
    } else {
        document.getElementById("contenuto").innerHTML = htmlOutput;
    }

})
.catch(()=>{
    document.getElementById("contenuto").innerText = "Errore nel caricamento dati.";
});

</script>

</body>
</html>






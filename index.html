<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Lotto Live ‚Äì Premium AI PRO+</title>

<style>
body{
    background:#111;
    color:white;
    font-family:Arial;
    text-align:center;
}

button{
    padding:10px 20px;
    margin:10px;
    font-size:16px;
    cursor:pointer;
}

#box{
    margin-top:30px;
    padding:20px;
    background:#222;
    border-radius:10px;
    width:85%;
    margin:auto;
}

.ruotaBox{
    border:1px solid #444;
    padding:10px;
    margin:10px;
    border-radius:8px;
}

.migliore{
    border:2px solid gold;
    background:#2a2a2a;
}

.stat{
    margin:4px;
}
</style>
</head>
<body>

<h1>üéØ Lotto Live ‚Äì Premium AI PRO+</h1>

<button onclick="generaPrevisione()">Genera Previsione AI</button>
<button onclick="simulaEstrazione()">Simula Estrazione</button>

<div id="box">
    <h2>üìä Statistiche Sistema</h2>
    <div id="percentualeBox">Percentuale Successo: 0%</div>
    <div id="analisiBox"></div>
    <div id="storicoBox"></div>
</div>

<script>

let estrazioniGlobali = {};

fetch("estrazioni.json")
.then(res => res.json())
.then(data => {
    estrazioniGlobali = data;
})
.catch(err => {
    alert("Errore caricamento estrazioni.json");
});


// ===== ANALISI RUOTA =====
function analizzaRuota(ruota){

    let datiRuota = estrazioniGlobali[ruota];
    let ultime = datiRuota.slice(-50);
    let conteggio = {};

    for(let i=1;i<=90;i++) conteggio[i]=0;

    ultime.forEach(estrazione=>{
        estrazione.forEach(numero=>{
            conteggio[numero]++;
        });
    });

    let ordinati = Object.entries(conteggio)
        .sort((a,b)=>b[1]-a[1]);

    let caldi = ordinati.slice(0,5).map(x=>parseInt(x[0]));
    let freddi = ordinati.slice(-5).map(x=>parseInt(x[0]));

    return {caldi, freddi, topFreq: ordinati[0][1]};
}


// ===== GENERA PREVISIONE =====
function generaPrevisione(){

    let ruote = Object.keys(estrazioniGlobali);
    if(ruote.length===0){
        alert("JSON non caricato");
        return;
    }

    let migliorRuota = null;
    let migliorFreq = -1;
    let analisiTotale = {};

    let html = "<h3>Analisi Ruote</h3>";

    ruote.forEach(ruota=>{

        let analisi = analizzaRuota(ruota);
        analisiTotale[ruota] = analisi;

        if(analisi.topFreq > migliorFreq){
            migliorFreq = analisi.topFreq;
            migliorRuota = ruota;
        }
    });

    ruote.forEach(ruota=>{

        let a = analisiTotale[ruota];
        let classe = ruota===migliorRuota ? "ruotaBox migliore" : "ruotaBox";

        html += `
        <div class="${classe}">
            <div><strong>${ruota} ${ruota===migliorRuota?"‚≠ê":" "}</strong></div>
            <div class="stat">Frequenza Top: ${a.topFreq} su 50</div>
            <div class="stat">Caldi: ${a.caldi.join(", ")}</div>
            <div class="stat">Freddi: ${a.freddi.join(", ")}</div>
        </div>
        `;
    });

    // PREVISIONE SULLA MIGLIORE
    let miglioreAnalisi = analisiTotale[migliorRuota];

    let caldoRandom = miglioreAnalisi.caldi[Math.floor(Math.random()*3)];
    let freddoRandom = miglioreAnalisi.freddi[Math.floor(Math.random()*3)];

    let numeri = [caldoRandom, freddoRandom];

    let previsione = {
        numeri,
        ruota: migliorRuota,
        durata: 8,
        estrazioniRestanti: 8,
        vinta:false
    };

    localStorage.setItem("previsioneAttiva", JSON.stringify(previsione));

    html += `
        <h3>üéØ Previsione Generata</h3>
        <div><strong>Ruota: ${migliorRuota}</strong></div>
        <div><strong>Numeri: ${numeri.join(" - ")}</strong></div>
    `;

    document.getElementById("analisiBox").innerHTML = html;
}


// ===== SIMULAZIONE =====
function simulaEstrazione(){

    let previsione = JSON.parse(localStorage.getItem("previsioneAttiva"));
    if(!previsione){
        alert("Genera prima previsione");
        return;
    }

    previsione.estrazioniRestanti--;

    if(Math.random()<0.25){
        previsione.vinta=true;
        alert("üéâ AMBO USCITO!");
        salvaStorico(previsione);
        localStorage.removeItem("previsioneAttiva");
    }

    if(!previsione.vinta && previsione.estrazioniRestanti<=0){
        salvaStorico(previsione);
        evolviSistema(previsione);
    } else if(!previsione.vinta){
        localStorage.setItem("previsioneAttiva", JSON.stringify(previsione));
    }

    mostraStorico();
    aggiornaPercentuale();
}


// ===== EVOLUZIONE =====
function evolviSistema(p){

    if(p.durata===8) p.durata=12;
    else if(p.durata===12) p.durata=16;
    else{
        generaPrevisione();
        return;
    }

    p.estrazioniRestanti=p.durata;
    p.vinta=false;

    localStorage.setItem("previsioneAttiva", JSON.stringify(p));
    alert("Sistema evoluto a durata "+p.durata);
}


// ===== STORICO =====
function salvaStorico(p){

    let storico = JSON.parse(localStorage.getItem("storicoLotto"))||[];

    storico.push({
        numeri:p.numeri,
        ruota:p.ruota,
        durata:p.durata,
        esito:p.vinta?"VINTA":"PERSA",
        data:new Date().toLocaleString()
    });

    localStorage.setItem("storicoLotto", JSON.stringify(storico));
}


function mostraStorico(){

    let storico = JSON.parse(localStorage.getItem("storicoLotto"))||[];
    let box=document.getElementById("storicoBox");

    box.innerHTML="<h3>Storico</h3>";

    if(storico.length===0){
        box.innerHTML+="<p>Nessuna giocata registrata.</p>";
        return;
    }

    storico.slice().reverse().forEach(s=>{
        box.innerHTML+=`
        <div>
        ${s.data} | ${s.ruota} | ${s.numeri.join(", ")} 
        <strong style="color:${s.esito==="VINTA"?"lime":"red"}">
        ${s.esito}
        </strong>
        </div>`;
    });
}


// ===== PERCENTUALE =====
function aggiornaPercentuale(){

    let storico=JSON.parse(localStorage.getItem("storicoLotto"))||[];
    let vinte=storico.filter(s=>s.esito==="VINTA").length;

    let perc=storico.length===0?0:
        ((vinte/storico.length)*100).toFixed(1);

    document.getElementById("percentualeBox").innerHTML=
        "Percentuale Successo: "+perc+"%";
}

document.addEventListener("DOMContentLoaded",()=>{
    mostraStorico();
    aggiornaPercentuale();
});

</script>

</body>
</html>
